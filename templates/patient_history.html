<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Patient History</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h3 class="text-center mb-4">
        Patient History for {{ patient.full_name }}
      </h3>
      {% if history_records %}
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Date & Time</th>
              <th>Doctor</th>
              <th>Disease</th>
              <th>Blockchain Hash</th>
              <th>QR Code</th>
            </tr>
          </thead>
          <tbody>
            {% for record in history_records %}
            <tr>
              <td>{{ record.updated_at|date:"Y-m-d H:i" }}</td>
              <td>{{ record.doctor_assigned|default:"Not assigned" }}</td>
              <td>{{ record.disease|default:"-" }}</td>
              <td>
                <small>{{ record.blockchain_hash|truncatechars:15 }}</small>
              </td>
              <td>
                {% if record.qr_code %}
                <img
                  src="{{ record.qr_code.url }}"
                  width="80"
                  height="80"
                  class="rounded border"
                />
                {% else %}
                <span class="text-muted">No QR</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-center text-muted">No previous updates found.</p>
      {% endif %}
      <div class="text-end mb-4">
        {% if source == "patient" %}
        <a href="{% url 'patient_dashboard' %}" class="btn btn-outline-success">
          ← Back to Patient Dashboard
        </a>
        {% elif source == "doctor" %}
        <a href="{% url 'doctor_dashboard' %}" class="btn btn-outline-primary">
          ← Back to Doctor Dashboard
        </a>
        {% else %}
        <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-secondary">
          ← Back to Admin Dashboard
        </a>
        {% endif %}
      </div>
    </div>
  </body>
</html>
