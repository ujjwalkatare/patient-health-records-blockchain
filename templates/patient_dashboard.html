{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MediCare - Patient Dashboard</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <style>
      :root {
        --primary-color: #0cb76b;
        --primary-dark: #09995a;
        --secondary-color: #2c3e50;
        --light-bg: #f8f9fa;
        --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        --hover-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
      }

      body {
        background-color: var(--light-bg);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .sidebar {
        min-height: 100vh;
        background: linear-gradient(
          180deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        padding-top: 1rem;
        box-shadow: 3px 0 15px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }

      .sidebar .brand {
        padding: 1.5rem 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 1rem;
      }

      .sidebar .brand h4 {
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .sidebar .nav-item {
        margin-bottom: 0.5rem;
      }

      .sidebar .nav-link {
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        margin: 0 0.5rem;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
      }

      .sidebar .nav-link:hover,
      .sidebar .nav-link.active {
        background: rgba(255, 255, 255, 0.15);
        border-left: 4px solid #fff;
      }

      .sidebar .nav-link i {
        font-size: 1.1rem;
        width: 24px;
        text-align: center;
      }

      .content-section {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .content-section.active {
        display: block;
      }

      .page-header {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: var(--card-shadow);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .stats-card {
        background: white;
        color: var(--secondary-color);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: var(--card-shadow);
        transition: transform 0.3s, box-shadow 0.3s;
        border-left: 4px solid var(--primary-color);
        height: 100%;
      }

      .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--hover-shadow);
      }

      .stats-card .card-icon {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
      }

      .stats-card h3 {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .stats-card h2 {
        font-size: 2rem;
        font-weight: 700;
        margin: 0;
      }

      .card {
        border: none;
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        transition: transform 0.3s, box-shadow 0.3s;
        margin-bottom: 1.5rem;
      }

      .card:hover {
        transform: translateY(-3px);
        box-shadow: var(--hover-shadow);
      }

      .card-header {
        font-weight: 600;
        font-size: 1.1rem;
        background: white;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding: 1rem 1.5rem;
        border-radius: 12px 12px 0 0 !important;
      }

      .table-responsive {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--card-shadow);
      }

      .table thead {
        background: linear-gradient(
          45deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
      }

      .table th {
        border: none;
        padding: 1rem;
        font-weight: 600;
      }

      .table td {
        padding: 1rem;
        vertical-align: middle;
      }

      .table tbody tr {
        transition: background-color 0.2s;
      }

      .table tbody tr:hover {
        background-color: rgba(12, 183, 107, 0.05);
      }

      .btn {
        border-radius: 8px;
        padding: 0.5rem 1.5rem;
        font-weight: 500;
        transition: all 0.3s;
      }

      .btn-primary {
        background: var(--primary-color);
        border: none;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
      }

      .btn-success {
        background: var(--primary-color);
        border: none;
      }

      .btn-success:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
      }

      .mobile-menu-btn {
        background: var(--primary-color);
        border: none;
        border-radius: 8px;
        padding: 0.5rem 1rem;
        color: white;
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 1rem;
      }

      .qr-img {
        max-width: 200px;
        border: 3px solid #ddd;
        border-radius: 10px;
        transition: transform 0.3s;
      }

      .qr-img:hover {
        transform: scale(1.05);
      }

      .blockchain-hash {
        font-family: monospace;
        background: #f8f9fa;
        padding: 0.75rem;
        border-radius: 8px;
        font-size: 0.85rem;
        word-break: break-all;
        border: 1px solid #e9ecef;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          transform: translateX(-100%);
          transition: transform 0.3s ease;
        }

        .sidebar.show {
          transform: translateX(0);
        }

        .stats-card h2 {
          font-size: 1.5rem;
        }

        .page-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 1rem;
        }

        .mobile-table-container {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .mobile-table {
          min-width: 600px;
        }

        .mobile-actions {
          display: flex;
          flex-wrap: wrap;
          gap: 0.25rem;
        }

        .mobile-actions .btn {
          flex: 1;
          min-width: 60px;
          padding: 0.4rem 0.5rem;
          font-size: 0.8rem;
        }

        .qr-img {
          max-width: 150px;
        }
      }

      @media (max-width: 991px) {
        .stats-card {
          text-align: center;
          padding: 1.25rem;
        }

        .stats-card .card-icon {
          margin: 0 auto 0.75rem auto;
        }

        .page-header {
          flex-direction: column;
          align-items: flex-start;
          text-align: center;
          gap: 0.75rem;
        }

        .page-header .d-flex {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <!-- Messages Display -->
    {% if messages %}
    <div class="alert-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
      {% for message in messages %}
      <div
        class="alert alert-{{ message.tags }} alert-dismissible fade show"
        role="alert"
      >
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block sidebar" id="sidebarMenu">
          <div class="brand">
            <h4><i class="bi bi-heart-pulse"></i> MediCare Patient</h4>
          </div>
          <div class="nav flex-column">
            <a class="nav-link active" onclick="showSection('dashboard', event)">
              <i class="bi bi-speedometer2"></i> Dashboard
            </a>
            <a class="nav-link" onclick="showSection('profile', event)">
              <i class="bi bi-person-circle"></i> My Profile
            </a>
            <a class="nav-link" onclick="showSection('blockchain', event)">
              <i class="bi bi-shield-check"></i> Blockchain Records
            </a>
            <a class="nav-link" onclick="showSection('history', event)">
              <i class="bi bi-clock-history"></i> Medical History
            </a>
            <a class="nav-link" onclick="showSection('appointments', event)">
              <i class="bi bi-calendar-check"></i> My Appointments
            </a>
            <a class="nav-link text-danger" href="{% url 'log_out' %}">
              <i class="bi bi-box-arrow-right"></i> Logout
            </a>
          </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
          <!-- Mobile Sidebar Toggle -->
          <button
            class="mobile-menu-btn d-md-none mb-3"
            type="button"
            onclick="toggleSidebar()"
          >
            <i class="bi bi-list"></i> Menu
          </button>

          <!-- Dashboard Section -->
          <div id="dashboard" class="content-section active">
            <div class="page-header">
              <h2 class="mb-0">Patient Dashboard</h2>
              <div class="d-flex align-items-center gap-3">
                <span class="fw-semibold d-none d-md-block">Welcome, {{ patient.full_name }}</span>
                <div class="dropdown">
                  <button
                    class="btn btn-outline-secondary dropdown-toggle"
                    type="button"
                    data-bs-toggle="dropdown"
                  >
                    <i class="bi bi-person-circle me-2"></i> Account
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                      <a class="dropdown-item" onclick="showSection('profile', event)"
                        ><i class="bi bi-person me-2"></i> Profile</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="#"
                        ><i class="bi bi-gear me-2"></i> Settings</a
                      >
                    </li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                      <a
                        class="dropdown-item text-danger"
                        href="{% url 'log_out' %}"
                        ><i class="bi bi-box-arrow-right me-2"></i> Logout</a
                      >
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Quick Stats -->
            <div class="row g-3 g-md-4 mb-4">
              <div class="col-12 col-md-4">
                <div class="stats-card text-center text-md-start">
                  <div class="card-icon mx-auto mx-md-0">
                    <i class="bi bi-file-medical"></i>
                  </div>
                  <h3>Medical Records</h3>
                  <h2>{{ history_records|length }}</h2>
                  <p class="text-muted mb-0">History entries</p>
                </div>
              </div>
              <div class="col-12 col-md-4">
                <div class="stats-card text-center text-md-start">
                  <div class="card-icon mx-auto mx-md-0">
                    <i class="bi bi-calendar-check"></i>
                  </div>
                  <h3>Appointments</h3>
                  <h2>0</h2>
                  <p class="text-muted mb-0">Scheduled visits</p>
                </div>
              </div>
              <div class="col-12 col-md-4">
                <div class="stats-card text-center text-md-start">
                  <div class="card-icon mx-auto mx-md-0">
                    <i class="bi bi-shield-check"></i>
                  </div>
                  <h3>Blockchain Status</h3>
                  <h2>{% if patient.blockchain_hash %}Active{% else %}Pending{% endif %}</h2>
                  <p class="text-muted mb-0">Secure records</p>
                </div>
              </div>
            </div>

            <!-- Recent Activity -->
            <div class="row">
              <div class="col-12 col-lg-6">
                <div class="card">
                  <div class="card-header">
                    <h5 class="mb-0">Recent Medical Updates</h5>
                  </div>
                  <div class="card-body">
                    {% if history_records %}
                    <div class="list-group list-group-flush">
                      {% for record in history_records|slice:":3" %}
                      <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          <h6 class="mb-1">{{ record.updated_at|date:"M d, Y" }}</h6>
                          <p class="mb-1 text-muted">{{ record.disease|default:"General checkup" }}</p>
                        </div>
                        <span class="badge bg-primary rounded-pill">Update</span>
                      </div>
                      {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted text-center my-3">No recent activity</p>
                    {% endif %}
                  </div>
                </div>
                
                <!-- Recent Visits -->
                {% if visits %}
                <div class="card mt-3">
                  <div class="card-header">
                    <h5 class="mb-0">Recent Visits</h5>
                  </div>
                  <div class="card-body">
                    <div class="list-group list-group-flush">
                      {% for v in visits|slice:":3" %}
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                          <div>
                            <h6 class="mb-1">{{ v.visit_date|date:"M d, Y" }} â€” Dr. {{ v.doctor.full_name }}</h6>
                            <p class="mb-1 text-muted">{{ v.diagnosis|default:"N/A" }}</p>
                          </div>
                          <div class="text-end">
                            {% if v.qr_code %}
                              <img src="{{ v.qr_code.url }}" width="60" class="rounded" />
                            {% endif %}
                            <div class="small blockchain-hash mt-2">{{ v.blockchain_hash|truncatechars:24 }}</div>
                            <a href="{% url 'patient_info' v.patient.id %}" class="btn btn-sm btn-outline-primary mt-2">View</a>
                          </div>
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
                {% endif %}
              </div>
              
              <div class="col-12 col-lg-6">
                <div class="card">
                  <div class="card-header">
                    <h5 class="mb-0">Quick Actions</h5>
                  </div>
                  <div class="card-body">
                    <div class="row g-2">
                      <div class="col-6">
                        <button class="btn btn-outline-primary w-100" onclick="showSection('appointments', event)">
                          <i class="bi bi-calendar-plus me-2"></i>Book Appointment
                        </button>
                      </div>
                      <div class="col-6">
                        <button class="btn btn-outline-success w-100" onclick="showSection('history', event)">
                          <i class="bi bi-clock-history me-2"></i>View History
                        </button>
                      </div>
                      <div class="col-6">
                        <button class="btn btn-outline-info w-100" onclick="showSection('blockchain', event)">
                          <i class="bi bi-shield-check me-2"></i>Blockchain Info
                        </button>
                      </div>
                      <div class="col-6">
                        <button class="btn btn-outline-warning w-100" onclick="showSection('profile', event)">
                          <i class="bi bi-person me-2"></i>My Profile
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Latest Doctor Update -->
                <div class="card mt-3">
                  <div class="card-header"><h5 class="mb-0">Latest Doctor Update</h5></div>
                  <div class="card-body">
                    {% if latest_visit %}
                      <div class="row">
                        <div class="col-md-5 text-center">
                          {% if latest_visit.qr_code %}
                            <img src="{{ latest_visit.qr_code.url }}" class="qr-img mb-2" alt="Latest QR">
                            <div><small class="text-muted">Scannable QR of latest record</small></div>
                            <a href="{{ latest_visit.qr_code.url }}" download class="btn btn-sm btn-outline-primary mt-2">Download QR</a>
                          {% else %}
                            <p class="text-muted">No QR available for latest visit.</p>
                          {% endif %}
                        </div>
                        <div class="col-md-7">
                          <p><strong>Doctor:</strong> Dr. {{ latest_visit.doctor.full_name }}</p>
                          <p><strong>Visit Date:</strong> {{ latest_visit.visit_date|date:"M d, Y" }}</p>
                          <p><strong>Diagnosis:</strong> {{ latest_visit.diagnosis|default:"N/A" }}</p>
                          <p><strong>Prescription:</strong> {{ latest_visit.prescription|default:"N/A" }}</p>
                          <p><strong>Blockchain Hash:</strong></p>
                          <div class="blockchain-hash">{{ latest_visit.blockchain_hash|default:"-" }}</div>
                          <button class="btn btn-sm btn-outline-primary mt-2" onclick="copyToClipboard('{{ latest_visit.blockchain_hash|default:'' }}', this)">
                            <i class="bi bi-clipboard me-1"></i>Copy Hash
                          </button>
                        </div>
                      </div>
                    {% else %}
                      <p class="text-muted">No doctor updates yet. Wait for your doctor to save a visit.</p>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Profile Section -->
          <div id="profile" class="content-section">
            <div class="page-header">
              <h2 class="mb-0">My Profile</h2>
            </div>
            
            <div class="row">
              <div class="col-12 col-lg-8">
                <div class="card">
                  <div class="card-header">
                    <h5 class="mb-0">Personal Information</h5>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>Full Name</strong></label>
                        <p>{{ patient.full_name }}</p>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>Email</strong></label>
                        <p>{{ patient.email }}</p>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>Phone</strong></label>
                        <p>{{ patient.phone }}</p>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>Age</strong></label>
                        <p>{{ patient.age }}</p>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>Gender</strong></label>
                        <p>{{ patient.gender }}</p>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>Current Condition</strong></label>
                        <p>{{ patient.disease|default:"Not specified" }}</p>
                      </div>
                      <div class="col-12 mb-3">
                        <label class="form-label"><strong>Assigned Doctor</strong></label>
                        <p>{{ patient.doctor_assigned|default:"Not assigned" }}</p>
                      </div>
                      <div class="col-12 mb-3">
                        <label class="form-label"><strong>Address</strong></label>
                        <p>{{ patient.address|default:"Not provided" }}</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-lg-4">
                <div class="card">
                  <div class="card-header">
                    <h5 class="mb-0">QR Code</h5>
                  </div>
                  <div class="card-body text-center">
                    {% if patient.qr_code %}
                    <img
                      src="{{ patient.qr_code.url }}"
                      alt="QR Code"
                      class="qr-img mb-3"
                    />
                    <p class="text-muted small">Scan to view blockchain records</p>
                    {% else %}
                    <div class="text-center py-4">
                      <i class="bi bi-qr-code text-muted" style="font-size: 4rem;"></i>
                      <p class="text-danger mt-2">No QR Code generated yet</p>
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Blockchain Section -->
          <div id="blockchain" class="content-section">
            <div class="page-header">
              <h2 class="mb-0">Blockchain Records</h2>
            </div>
            
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Blockchain Security Information</h5>
              </div>
              <div class="card-body">
                {% if patient.blockchain_hash %}
                <div class="alert alert-success">
                  <i class="bi bi-check-circle me-2"></i>
                  Your medical records are securely stored on the blockchain
                </div>
                
                <div class="row">
                  <div class="col-md-6 mb-4">
                    <h6>Blockchain Hash</h6>
                    <div class="blockchain-hash">
                      {{ patient.blockchain_hash }}
                    </div>
                    <button
                      class="btn btn-sm btn-outline-primary mt-2"
                      onclick="copyToClipboard('{{ patient.blockchain_hash }}', this)"
                    >
                      <i class="bi bi-clipboard me-1"></i>Copy Hash
                    </button>
                  </div>
                  
                  {% if patient.tx_hash %}
                  <div class="col-md-6 mb-4">
                    <h6>Transaction Hash</h6>
                    <div class="blockchain-hash">
                      {{ patient.tx_hash }}
                    </div>
                    <button
                      class="btn btn-sm btn-outline-primary mt-2"
                      onclick="copyToClipboard('{{ patient.tx_hash }}', this)"
                    >
                      <i class="bi bi-clipboard me-1"></i>Copy TX Hash
                    </button>
                  </div>
                  {% endif %}
                </div>
                
                <div class="mt-4">
                  <h6>How Blockchain Protects Your Data</h6>
                  <ul class="list-unstyled">
                    <li><i class="bi bi-check text-success me-2"></i>Immutable record keeping</li>
                    <li><i class="bi bi-check text-success me-2"></i>Transparent audit trail</li>
                    <li><i class="bi bi-check text-success me-2"></i>Secure data verification</li>
                    <li><i class="bi bi-check text-success me-2"></i>Prevents unauthorized changes</li>
                  </ul>
                </div>
                {% else %}
                <div class="text-center py-4">
                  <i class="bi bi-shield-exclamation text-warning" style="font-size: 3rem;"></i>
                  <h5 class="text-warning mt-3">No Blockchain Record Found</h5>
                  <p class="text-muted">Your records will be secured on blockchain after first medical update</p>
                </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- History Section -->
          <div id="history" class="content-section">
            <div class="page-header">
              <h2 class="mb-0">Medical History</h2>
            </div>
            
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Complete Medical History</h5>
              </div>
              <div class="card-body">
                {% if history_records %}
                <div class="mobile-table-container">
                  <table class="table table-hover mobile-table">
                    <thead>
                      <tr>
                        <th>Date & Time</th>
                        <th>Condition</th>
                        <th>Doctor Assigned</th>
                        <th>Blockchain Hash</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for record in history_records %}
                      <tr>
                        <td>{{ record.updated_at|date:"M d, Y H:i" }}</td>
                        <td>{{ record.disease|default:"General checkup" }}</td>
                        <td>{{ record.doctor_assigned|default:"Not assigned" }}</td>
                        <td>
                          {% if record.blockchain_hash %}
                          <small class="text-muted">{{ record.blockchain_hash|truncatechars:20 }}</small>
                          {% else %}
                          <span class="text-muted">-</span>
                          {% endif %}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                  <i class="bi bi-clock-history text-muted" style="font-size: 3rem;"></i>
                  <p class="text-muted mt-2">No medical history records available</p>
                </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Appointments Section -->
          <div id="appointments" class="content-section">
            <div class="page-header">
              <h2 class="mb-0">My Appointments</h2>
              <button class="btn btn-primary">
                <i class="bi bi-plus-circle me-2"></i>Book New Appointment
              </button>
            </div>

            <!-- Doctor Request Section Inside Appointments -->
            <div class="card mb-4">
              <div class="card-header">
                <h5 class="mb-0">Send Request to Doctor</h5>
              </div>
              <div class="card-body">
                {% if doctors %}
                  <div class="row">
                    {% for doctor in doctors %}
                    <div class="col-md-4 mb-3">
                      <div class="border p-3 rounded shadow-sm">
                        <h6 class="mb-1">{{ doctor.full_name }}</h6>
                        <small class="text-muted">{{ doctor.specialization }}</small><br>

                        <!-- Fixed doctor.id reference -->
                        <a href="{% url 'send_request_to_doctor' doctor.id %}" class="btn btn-success btn-sm">
                          Send Request
                        </a>

                      </div>
                    </div>
                    {% endfor %}
                  </div>
                {% else %}
                  <p class="text-muted">No doctors available right now.</p>
                {% endif %}
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      function showSection(sectionId, evt = null) {
        // Update active nav link
        document.querySelectorAll(".nav-link").forEach((link) => {
          link.classList.remove("active");
        });
        if (evt && evt.currentTarget) evt.currentTarget.classList.add("active");

        // Show selected section
        document.querySelectorAll(".content-section").forEach((section) => {
          section.classList.remove("active");
        });
        document.getElementById(sectionId).classList.add("active");

        // Close sidebar on mobile after selection
        if (window.innerWidth < 768) {
          toggleSidebar();
        }
      }

      function toggleSidebar() {
        const sidebar = document.getElementById("sidebarMenu");
        sidebar.classList.toggle("show");
      }

      // Close sidebar when clicking outside on mobile
      document.addEventListener("click", function (event) {
        const sidebar = document.getElementById("sidebarMenu");
        const menuBtn = document.querySelector(".mobile-menu-btn");

        if (
          window.innerWidth < 768 &&
          !sidebar.contains(event.target) &&
          !menuBtn.contains(event.target) &&
          sidebar.classList.contains("show")
        ) {
          sidebar.classList.remove("show");
        }
      });

      // Auto-hide alerts after 5 seconds
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
          const alerts = document.querySelectorAll(".alert");
          alerts.forEach(function (alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          });
        }, 5000);
      });

      function copyToClipboard(text, btn) {
        if (!text) return;
        navigator.clipboard.writeText(text).then(function() {
          // Show success message
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i class="bi bi-check me-1"></i>Copied!';
          btn.classList.remove('btn-outline-primary');
          btn.classList.add('btn-success');
          
          setTimeout(function() {
            btn.innerHTML = originalText;
            btn.classList.remove('btn-success');
            btn.classList.add('btn-outline-primary');
          }, 2000);
        });
      }
    </script>
  </body>
</html>